{"version":3,"sources":["assets/scripts/bullets.js"],"names":["cc","Class","Component","srcHeight","Number","srcWidth","properties","direction","v2","speed","damage","type","Integer","tooltip","lifeTime","Float","boundaryX","boundaryY","onLoad","view","getCanvasSize","height","width","collider","getComponent","BoxCollider","addComponent","size","node","group","manager","director","getCollisionManager","enabled","scheduleOnce","isValid","log","destroy","start","setDirection","dir","setSpeed","setDamage","onCollisionEnter","other","self","monster","takeDamage","update","dt","newPos","position","add","mul","setPosition","screenSize","getVisibleSize","Math","abs","x","y"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    srcHeight: Number,\n    srcWidth: Number,\n\n    properties: {\n        direction: cc.v2(0, 1),\n        speed: 0,\n        damage: {\n            default: 20,\n            type: cc.Integer,\n            tooltip: '子弹伤害值'\n        },\n        lifeTime: {\n            default: 3,\n            type: cc.Float,\n            tooltip: '子弹生存时间（秒）'\n        },\n        boundaryX: 480,\n        boundaryY: 960\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.srcHeight = cc.view.getCanvasSize().height;\n        this.srcWidth = cc.view.getCanvasSize().width;\n        // 添加碰撞体\n        let collider = this.getComponent(cc.BoxCollider);\n        if (!collider) {\n            collider = this.addComponent(cc.BoxCollider);\n            collider.size.width = this.node.width;\n            collider.size.height = this.node.height;\n        }\n        \n        // 设置碰撞组\n        this.node.group = 'bullet';\n        \n        // 启用碰撞检测系统\n        let manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n\n        // 设置定时销毁\n        this.scheduleOnce(() => {\n            if (this.node && this.node.isValid) {\n                cc.log('子弹到达生存时间上限，自动销毁');\n                this.node.destroy();\n            }\n        }, this.lifeTime);\n    },\n\n    start () {\n\n    },\n\n    setDirection(dir) {\n        this.direction = dir;\n    },\n\n    setSpeed(speed) {\n        this.speed = speed;\n    },\n\n    setDamage(damage) {\n        this.damage = damage;\n    },\n\n    onCollisionEnter(other, self) {\n        if (other.node.group === 'monster') {\n            let monster = other.node.getComponent('Monster');\n            if (monster) {\n                monster.takeDamage(this.damage);\n                cc.log('子弹击中怪物！造成伤害:', this.damage);\n            }\n            // 销毁子弹\n            this.node.destroy();\n        }\n    },\n\n    update (dt) {\n        // 移动子弹\n        let newPos = this.node.position.add(this.direction.mul(this.speed * dt));\n        this.node.setPosition(newPos);\n        \n        // 如果子弹超出屏幕范围，销毁子弹\n        let screenSize = cc.view.getVisibleSize();\n        if (Math.abs(this.node.x) > screenSize.width/2 || Math.abs(this.node.y) > screenSize.height/2) {\n            this.node.destroy();\n        }\n    }\n});\n"]}