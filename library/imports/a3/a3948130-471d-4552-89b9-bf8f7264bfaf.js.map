{"version":3,"sources":["assets/scripts/game.js"],"names":["cc","Class","Component","properties","tiledMap","TiledMap","goldLabel","type","Label","tooltip","statics","instance","addGold","amount","_goldCount","string","gameManager","find","getComponent","updateGold","onLoad","constructor","p","director","getPhysicsManager","enabled","debugDrawFlags","gravity","v2","document","addEventListener","resources","load","AudioClip","err","audioClip","error","audioSource","addComponent","AudioSource","clip","play","start","tiledSize","getTileSize","layer","getLayer","layerSize","getLayerSize","i","width","j","height","tiled","getTiledTileAt","gid","node","group","body","RigidBody","RigidBodyType","Static","collider","PhysicsBoxCollider","offset","size","apply"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiledMap: cc.TiledMap,\n        goldLabel: {\n            default: null,\n            type: cc.Label,\n            tooltip: '金币数量显示文本'\n        }\n    },\n\n    statics: {\n        instance: null,\n        addGold(amount) {\n            if (this.instance) {\n                this.instance._goldCount += amount;\n                if (this.instance.goldLabel) {\n                    this.instance.goldLabel.string = this.instance._goldCount;\n                }\n                // 同步更新GameManager的金币数\n                let gameManager = cc.find('Canvas').getComponent('GameManager');\n                if (gameManager) {\n                    gameManager.updateGold(this.instance._goldCount);\n                }\n            }\n        }\n    },\n\n    _goldCount: 0,\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        // 初始化静态实例\n        this.constructor.instance = this;\n        \n        // 初始化物理系统\n        let p = cc.director.getPhysicsManager();\n        p.enabled = true;\n        p.debugDrawFlags = false;\n        p.gravity = cc.v2(0,0);\n        \n        // 初始化金币显示\n        this._goldCount = 0;\n        if (this.goldLabel) {\n            this.goldLabel.string = this._goldCount;\n        }\n\n        // 初始化微信音频\n        document.addEventListener('WeixinJSBridgeReady', () => {\n            cc.resources.load('audios/rock', cc.AudioClip, (err, audioClip) => {\n                if (err) {\n                    cc.error('加载音频失败:', err);\n                    return;\n                }\n                let audioSource = this.addComponent(cc.AudioSource);\n                audioSource.clip = audioClip;\n                audioSource.play();\n            });\n        });\n    },\n\n    start () {\n        let tiledSize = this.tiledMap.getTileSize();\n        let layer = this.tiledMap.getLayer('fences');\n        let layerSize = layer.getLayerSize();\n\n        for (let i = 0; i < layerSize.width; i++) {\n            for(let j=0; j<layerSize.height; j++){\n                let tiled = layer.getTiledTileAt(i, j, true);\n                if(tiled.gid != 0){\n                    tiled.node.group = 'wall';\n                    let body = tiled.node.addComponent(cc.RigidBody);\n                    body.type = cc.RigidBodyType.Static;\n                    let collider = tiled.node.addComponent(cc.PhysicsBoxCollider);\n                    collider.offset = cc.v2(tiledSize.width/2, tiledSize.height/2);\n                    collider.size = tiledSize;\n                    collider.apply();\n                }\n            }\n        }\n\n    },\n\n    // update (dt) {},\n});\n"]}