
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Monster.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9d5a02WiMxF572qa+T4fVyu', 'Monster');
// scripts/Monster.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    maxHealth: {
      "default": 100,
      type: cc.Integer,
      tooltip: '怪物最大生命值'
    },
    currentHealth: {
      "default": 100,
      type: cc.Integer,
      tooltip: '怪物当前生命值'
    },
    healthBar: {
      "default": null,
      type: cc.Node,
      tooltip: '血条节点'
    },
    hitAudio: {
      "default": null,
      type: cc.AudioClip,
      tooltip: '受击音效'
    },
    deathAudio: {
      "default": null,
      type: cc.AudioClip,
      tooltip: '死亡音效'
    },
    bombPrefab: {
      "default": null,
      type: cc.Prefab,
      tooltip: '炸弹预制体'
    },
    detectionRadius: {
      "default": 300,
      type: cc.Float,
      tooltip: '检测玩家的范围'
    },
    moveSpeed: {
      "default": 50,
      type: cc.Float,
      tooltip: '移动速度'
    },
    shootInterval: {
      "default": 2.0,
      type: cc.Float,
      tooltip: '发射间隔'
    }
  },
  onLoad: function onLoad() {
    this.currentHealth = this.maxHealth;
    this.lastShootTime = 0; // 确保初始化射击时间
    // 检查是否有炸弹预制体

    if (!this.bombPrefab) {
      cc.error('未设置炸弹预制体！');
    } // 确保有碰撞组件


    var collider = this.getComponent(cc.BoxCollider);

    if (!collider) {
      collider = this.addComponent(cc.BoxCollider);
      collider.size.width = this.node.width;
      collider.size.height = this.node.height;
    } // 设置碰撞组


    this.node.group = 'monster'; // 获取血条中的 Bar 节点

    if (this.healthBar) {
      this.barNode = this.healthBar.getChildByName('Bar');

      if (!this.barNode) {
        cc.error('找不到 Bar 节点！');
        return;
      } // 保存初始宽度


      this.originalBarWidth = this.barNode.width;
      cc.log('血条初始宽度：', this.originalBarWidth);
    } else {
      cc.error('未设置血条节点！');
    } // 添加死亡标记


    this.isDying = false; // 添加刚体组件

    var rigidBody = this.getComponent(cc.RigidBody);

    if (!rigidBody) {
      rigidBody = this.addComponent(cc.RigidBody);
      rigidBody.type = cc.RigidBodyType.Dynamic;
      rigidBody.fixedRotation = true;
    }
  },
  createHealthBar: function createHealthBar() {
    // 创建血条节点
    var healthBarNode = new cc.Node('HealthBar');
    this.node.addChild(healthBarNode);
    healthBarNode.zIndex = 1; // 创建背景条

    var barBgNode = new cc.Node('BarBg');
    healthBarNode.addChild(barBgNode);
    var barBgSprite = barBgNode.addComponent(cc.Sprite);
    barBgSprite.color = cc.Color.RED; // 创建血量条

    var barNode = new cc.Node('Bar');
    healthBarNode.addChild(barNode);
    var barSprite = barNode.addComponent(cc.Sprite);
    barSprite.color = cc.Color.GREEN; // 设置血条尺寸和位置

    healthBarNode.width = 100;
    healthBarNode.height = 10;
    barBgNode.width = 100;
    barBgNode.height = 10;
    barNode.width = 100;
    barNode.height = 10; // 将血条放在怪物上方

    healthBarNode.setPosition(0, this.node.height / 2 + 10); // 保存引用

    this.healthBar = healthBarNode;
    this.healthBarBg = barBgNode;
  },
  start: function start() {
    this.updateHealthBar();
  },
  takeDamage: function takeDamage(damage) {
    // 如果已经在死亡过程中，不再处理伤害
    if (this.isDying) return;
    if (typeof damage !== 'number' || damage <= 0) return; // 使用 playEffect 播放音效

    if (this.hitAudio) {
      cc.audioEngine.playEffect(this.hitAudio, false, 0.3);
    } // 减少生命值


    this.currentHealth = Math.max(0, this.currentHealth - damage); // 更新血条显示

    if (this.barNode && this.originalBarWidth) {
      var healthPercentage = this.currentHealth / this.maxHealth;
      this.barNode.width = this.originalBarWidth * healthPercentage;
    }

    cc.log('怪物受到伤害:', damage, '当前生命值:', this.currentHealth); // 检查是否死亡

    if (this.currentHealth <= 0 && !this.isDying) {
      this.die();
    }
  },
  updateHealthBar: function updateHealthBar() {
    if (this.healthBar) {
      var healthPercentage = this.currentHealth / this.maxHealth;
      this.healthBar.width = 100 * healthPercentage;
    }
  },
  die: function die() {
    var _this = this;

    // 设置死亡标记
    if (this.isDying) return;
    this.isDying = true; // 使用 playEffect 播放音效

    if (this.deathAudio) {
      var audioId = cc.audioEngine.playEffect(this.deathAudio, false, 0.3);
      cc.audioEngine.setFinishCallback(audioId, function () {
        _this.node.destroy();
      });
    } else {
      this.node.destroy();
    }
  },
  update: function update(dt) {
    if (this.isDying) return; // 获取玩家节点

    var player = cc.find('Canvas/game/player');

    if (!player) {
      cc.warn('找不到玩家节点！请确保场景中玩家节点的路径是 Canvas/game/player');
      return;
    } // 获取世界坐标下的位置


    var monsterPos = this.node.parent.convertToWorldSpaceAR(this.node.position);
    var playerPos = player.parent.convertToWorldSpaceAR(player.position); // 计算与玩家的距离

    var distance = cc.Vec2.distance(cc.v2(monsterPos.x, monsterPos.y), cc.v2(playerPos.x, playerPos.y)); // 添加调试日志

    cc.log('怪物位置:', monsterPos, '玩家位置:', playerPos, '距离:', distance, '检测范围:', this.detectionRadius); // 在检测范围内

    if (distance < this.detectionRadius) {
      // 追踪玩家
      var direction = cc.v2(playerPos.x - monsterPos.x, playerPos.y - monsterPos.y).normalize();
      var velocity = this.node.getComponent(cc.RigidBody).linearVelocity;
      velocity.x = direction.x * this.moveSpeed;
      velocity.y = direction.y * this.moveSpeed;
      this.node.getComponent(cc.RigidBody).linearVelocity = velocity;
      cc.log('怪物正在移动，速度:', velocity); // 发射炸弹

      this.shootBomb(player.position);
    } else {
      // 停止移动
      var _velocity = this.node.getComponent(cc.RigidBody).linearVelocity;
      _velocity.x = 0;
      _velocity.y = 0;
      this.node.getComponent(cc.RigidBody).linearVelocity = _velocity;
      cc.log('怪物停止移动，超出检测范围');
    }
  },
  shootBomb: function shootBomb(targetPos) {
    var currentTime = cc.director.getTotalTime() / 1000;
    cc.log('尝试发射炸弹 - 当前时间:', currentTime, '上次发射时间:', this.lastShootTime, '发射间隔:', this.shootInterval, '是否可以发射:', currentTime - this.lastShootTime >= this.shootInterval);

    if (currentTime - this.lastShootTime < this.shootInterval) {
      return;
    }

    if (!this.bombPrefab) {
      cc.error('炸弹预制体未设置！请在编辑器中设置 Monster 组件的 Bomb Prefab 属性');
      return;
    }

    this.lastShootTime = currentTime; // 创建炸弹

    var bomb = cc.instantiate(this.bombPrefab);

    if (!bomb) {
      cc.error('炸弹预制体实例化失败！');
      return;
    } // 设置炸弹位置为怪物当前位置


    bomb.setPosition(this.node.position);
    this.node.parent.addChild(bomb); // 计算方向（使用本地坐标）

    var direction = targetPos.sub(this.node.position); // 设置炸弹属性

    var bombComp = bomb.getComponent('Bomb');

    if (bombComp) {
      bombComp.setDirection(direction);
      bombComp.setSpeed(300); // 增加速度使炸弹移动更明显

      bombComp.setDamage(20);
      cc.log('炸弹已发射！方向:', direction, '目标位置:', targetPos, '当前位置:', this.node.position);
    } else {
      cc.error('炸弹没有Bomb组件！请确保炸弹预制体已添加 Bomb 组件');
      bomb.destroy();
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL01vbnN0ZXIuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJtYXhIZWFsdGgiLCJ0eXBlIiwiSW50ZWdlciIsInRvb2x0aXAiLCJjdXJyZW50SGVhbHRoIiwiaGVhbHRoQmFyIiwiTm9kZSIsImhpdEF1ZGlvIiwiQXVkaW9DbGlwIiwiZGVhdGhBdWRpbyIsImJvbWJQcmVmYWIiLCJQcmVmYWIiLCJkZXRlY3Rpb25SYWRpdXMiLCJGbG9hdCIsIm1vdmVTcGVlZCIsInNob290SW50ZXJ2YWwiLCJvbkxvYWQiLCJsYXN0U2hvb3RUaW1lIiwiZXJyb3IiLCJjb2xsaWRlciIsImdldENvbXBvbmVudCIsIkJveENvbGxpZGVyIiwiYWRkQ29tcG9uZW50Iiwic2l6ZSIsIndpZHRoIiwibm9kZSIsImhlaWdodCIsImdyb3VwIiwiYmFyTm9kZSIsImdldENoaWxkQnlOYW1lIiwib3JpZ2luYWxCYXJXaWR0aCIsImxvZyIsImlzRHlpbmciLCJyaWdpZEJvZHkiLCJSaWdpZEJvZHkiLCJSaWdpZEJvZHlUeXBlIiwiRHluYW1pYyIsImZpeGVkUm90YXRpb24iLCJjcmVhdGVIZWFsdGhCYXIiLCJoZWFsdGhCYXJOb2RlIiwiYWRkQ2hpbGQiLCJ6SW5kZXgiLCJiYXJCZ05vZGUiLCJiYXJCZ1Nwcml0ZSIsIlNwcml0ZSIsImNvbG9yIiwiQ29sb3IiLCJSRUQiLCJiYXJTcHJpdGUiLCJHUkVFTiIsInNldFBvc2l0aW9uIiwiaGVhbHRoQmFyQmciLCJzdGFydCIsInVwZGF0ZUhlYWx0aEJhciIsInRha2VEYW1hZ2UiLCJkYW1hZ2UiLCJhdWRpb0VuZ2luZSIsInBsYXlFZmZlY3QiLCJNYXRoIiwibWF4IiwiaGVhbHRoUGVyY2VudGFnZSIsImRpZSIsImF1ZGlvSWQiLCJzZXRGaW5pc2hDYWxsYmFjayIsImRlc3Ryb3kiLCJ1cGRhdGUiLCJkdCIsInBsYXllciIsImZpbmQiLCJ3YXJuIiwibW9uc3RlclBvcyIsInBhcmVudCIsImNvbnZlcnRUb1dvcmxkU3BhY2VBUiIsInBvc2l0aW9uIiwicGxheWVyUG9zIiwiZGlzdGFuY2UiLCJWZWMyIiwidjIiLCJ4IiwieSIsImRpcmVjdGlvbiIsIm5vcm1hbGl6ZSIsInZlbG9jaXR5IiwibGluZWFyVmVsb2NpdHkiLCJzaG9vdEJvbWIiLCJ0YXJnZXRQb3MiLCJjdXJyZW50VGltZSIsImRpcmVjdG9yIiwiZ2V0VG90YWxUaW1lIiwiYm9tYiIsImluc3RhbnRpYXRlIiwic3ViIiwiYm9tYkNvbXAiLCJzZXREaXJlY3Rpb24iLCJzZXRTcGVlZCIsInNldERhbWFnZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7RUFDTCxXQUFTRCxFQUFFLENBQUNFLFNBRFA7RUFHTEMsVUFBVSxFQUFFO0lBQ1JDLFNBQVMsRUFBRTtNQUNQLFdBQVMsR0FERjtNQUVQQyxJQUFJLEVBQUVMLEVBQUUsQ0FBQ00sT0FGRjtNQUdQQyxPQUFPLEVBQUU7SUFIRixDQURIO0lBTVJDLGFBQWEsRUFBRTtNQUNYLFdBQVMsR0FERTtNQUVYSCxJQUFJLEVBQUVMLEVBQUUsQ0FBQ00sT0FGRTtNQUdYQyxPQUFPLEVBQUU7SUFIRSxDQU5QO0lBV1JFLFNBQVMsRUFBRTtNQUNQLFdBQVMsSUFERjtNQUVQSixJQUFJLEVBQUVMLEVBQUUsQ0FBQ1UsSUFGRjtNQUdQSCxPQUFPLEVBQUU7SUFIRixDQVhIO0lBZ0JSSSxRQUFRLEVBQUU7TUFDTixXQUFTLElBREg7TUFFTk4sSUFBSSxFQUFFTCxFQUFFLENBQUNZLFNBRkg7TUFHTkwsT0FBTyxFQUFFO0lBSEgsQ0FoQkY7SUFxQlJNLFVBQVUsRUFBRTtNQUNSLFdBQVMsSUFERDtNQUVSUixJQUFJLEVBQUVMLEVBQUUsQ0FBQ1ksU0FGRDtNQUdSTCxPQUFPLEVBQUU7SUFIRCxDQXJCSjtJQTBCUk8sVUFBVSxFQUFFO01BQ1IsV0FBUyxJQUREO01BRVJULElBQUksRUFBRUwsRUFBRSxDQUFDZSxNQUZE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LENBQWhCLENBL0JpQixDQWlDakI7O0lBQ0EsSUFBSW1CLFFBQVEsR0FBR0gsSUFBSSxDQUFDckUsWUFBTCxDQUFrQixNQUFsQixDQUFmOztJQUNBLElBQUl3RSxRQUFKLEVBQWM7TUFDVkEsUUFBUSxDQUFDQyxZQUFULENBQXNCYixTQUF0QjtNQUNBWSxRQUFRLENBQUNFLFFBQVQsQ0FBa0IsR0FBbEIsRUFGVSxDQUVjOztNQUN4QkYsUUFBUSxDQUFDRyxTQUFULENBQW1CLEVBQW5CO01BQ0FuRyxFQUFFLENBQUNtQyxHQUFILENBQU8sV0FBUCxFQUFvQmlELFNBQXBCLEVBQStCLE9BQS9CLEVBQXdDSyxTQUF4QyxFQUFtRCxPQUFuRCxFQUE0RCxLQUFLNUQsSUFBTCxDQUFVZ0QsUUFBdEU7SUFDSCxDQUxELE1BS087TUFDSDdFLEVBQUUsQ0FBQ3NCLEtBQUgsQ0FBUyxnQ0FBVDtNQUNBdUUsSUFBSSxDQUFDekIsT0FBTDtJQUNIO0VBQ0o7QUF2UkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiBcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIG1heEhlYWx0aDoge1xuICAgICAgICAgICAgZGVmYXVsdDogMTAwLFxuICAgICAgICAgICAgdHlwZTogY2MuSW50ZWdlcixcbiAgICAgICAgICAgIHRvb2x0aXA6ICfmgKrnianmnIDlpKfnlJ/lkb3lgLwnXG4gICAgICAgIH0sXG4gICAgICAgIGN1cnJlbnRIZWFsdGg6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IDEwMCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkludGVnZXIsXG4gICAgICAgICAgICB0b29sdGlwOiAn5oCq54mp5b2T5YmN55Sf5ZG95YC8J1xuICAgICAgICB9LFxuICAgICAgICBoZWFsdGhCYXI6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlLFxuICAgICAgICAgICAgdG9vbHRpcDogJ+ihgOadoeiKgueCuSdcbiAgICAgICAgfSxcbiAgICAgICAgaGl0QXVkaW86IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5BdWRpb0NsaXAsXG4gICAgICAgICAgICB0b29sdGlwOiAn5Y+X5Ye76Z+z5pWIJ1xuICAgICAgICB9LFxuICAgICAgICBkZWF0aEF1ZGlvOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuQXVkaW9DbGlwLFxuICAgICAgICAgICAgdG9vbHRpcDogJ+atu+S6oemfs+aViCdcbiAgICAgICAgfSxcbiAgICAgICAgYm9tYlByZWZhYjoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYixcbiAgICAgICAgICAgIHRvb2x0aXA6ICfngrjlvLnpooTliLbkvZMnXG4gICAgICAgIH0sXG4gICAgICAgIGRldGVjdGlvblJhZGl1czoge1xuICAgICAgICAgICAgZGVmYXVsdDogMzAwLFxuICAgICAgICAgICAgdHlwZTogY2MuRmxvYXQsXG4gICAgICAgICAgICB0b29sdGlwOiAn5qOA5rWL546p5a6255qE6IyD5Zu0J1xuICAgICAgICB9LFxuICAgICAgICBtb3ZlU3BlZWQ6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IDUwLFxuICAgICAgICAgICAgdHlwZTogY2MuRmxvYXQsXG4gICAgICAgICAgICB0b29sdGlwOiAn56e75Yqo6YCf5bqmJ1xuICAgICAgICB9LFxuICAgICAgICBzaG9vdEludGVydmFsOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiAyLjAsXG4gICAgICAgICAgICB0eXBlOiBjYy5GbG9hdCxcbiAgICAgICAgICAgIHRvb2x0aXA6ICflj5HlsITpl7TpmpQnXG4gICAgICAgIH1cbiAgICB9LFxuIFxuICAgIG9uTG9hZCgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50SGVhbHRoID0gdGhpcy5tYXhIZWFsdGg7XG4gICAgICAgIHRoaXMubGFzdFNob290VGltZSA9IDA7IC8vIOehruS/neWIneWni+WMluWwhOWHu+aXtumXtFxuICAgICAgICBcbiAgICAgICAgLy8g5qOA5p+l5piv5ZCm5pyJ54K45by56aKE5Yi25L2TXG4gICAgICAgIGlmICghdGhpcy5ib21iUHJlZmFiKSB7XG4gICAgICAgICAgICBjYy5lcnJvcign5pyq6K6+572u54K45by56aKE5Yi25L2T77yBJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIOehruS/neacieeisOaSnue7hOS7tlxuICAgICAgICBsZXQgY29sbGlkZXIgPSB0aGlzLmdldENvbXBvbmVudChjYy5Cb3hDb2xsaWRlcik7XG4gICAgICAgIGlmICghY29sbGlkZXIpIHtcbiAgICAgICAgICAgIGNvbGxpZGVyID0gdGhpcy5hZGRDb21wb25lbnQoY2MuQm94Q29sbGlkZXIpO1xuICAgICAgICAgICAgY29sbGlkZXIuc2l6ZS53aWR0aCA9IHRoaXMubm9kZS53aWR0aDtcbiAgICAgICAgICAgIGNvbGxpZGVyLnNpemUuaGVpZ2h0ID0gdGhpcy5ub2RlLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICAvLyDorr7nva7norDmkp7nu4RcbiAgICAgICAgdGhpcy5ub2RlLmdyb3VwID0gJ21vbnN0ZXInO1xuIFxuICAgICAgICAvLyDojrflj5booYDmnaHkuK3nmoQgQmFyIOiKgueCuVxuICAgICAgICBpZiAodGhpcy5oZWFsdGhCYXIpIHtcbiAgICAgICAgICAgIHRoaXMuYmFyTm9kZSA9IHRoaXMuaGVhbHRoQmFyLmdldENoaWxkQnlOYW1lKCdCYXInKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5iYXJOb2RlKSB7XG4gICAgICAgICAgICAgICAgY2MuZXJyb3IoJ+aJvuS4jeWIsCBCYXIg6IqC54K577yBJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g5L+d5a2Y5Yid5aeL5a695bqmXG4gICAgICAgICAgICB0aGlzLm9yaWdpbmFsQmFyV2lkdGggPSB0aGlzLmJhck5vZGUud2lkdGg7XG4gICAgICAgICAgICBjYy5sb2coJ+ihgOadoeWIneWni+WuveW6pu+8micsIHRoaXMub3JpZ2luYWxCYXJXaWR0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5lcnJvcign5pyq6K6+572u6KGA5p2h6IqC54K577yBJyk7XG4gICAgICAgIH1cbiBcbiAgICAgICAgLy8g5re75Yqg5q275Lqh5qCH6K6wXG4gICAgICAgIHRoaXMuaXNEeWluZyA9IGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgLy8g5re75Yqg5Yia5L2T57uE5Lu2XG4gICAgICAgIGxldCByaWdpZEJvZHkgPSB0aGlzLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpO1xuICAgICAgICBpZiAoIXJpZ2lkQm9keSkge1xuICAgICAgICAgICAgcmlnaWRCb2R5ID0gdGhpcy5hZGRDb21wb25lbnQoY2MuUmlnaWRCb2R5KTtcbiAgICAgICAgICAgIHJpZ2lkQm9keS50eXBlID0gY2MuUmlnaWRCb2R5VHlwZS5EeW5hbWljO1xuICAgICAgICAgICAgcmlnaWRCb2R5LmZpeGVkUm90YXRpb24gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcbiBcbiAgICBjcmVhdGVIZWFsdGhCYXIoKSB7XG4gICAgICAgIC8vIOWIm+W7uuihgOadoeiKgueCuVxuICAgICAgICBsZXQgaGVhbHRoQmFyTm9kZSA9IG5ldyBjYy5Ob2RlKCdIZWFsdGhCYXInKTtcbiAgICAgICAgdGhpcy5ub2RlLmFkZENoaWxkKGhlYWx0aEJhck5vZGUpO1xuICAgICAgICBoZWFsdGhCYXJOb2RlLnpJbmRleCA9IDE7XG4gICAgICAgIFxuICAgICAgICAvLyDliJvlu7rog4zmma/mnaFcbiAgICAgICAgbGV0IGJhckJnTm9kZSA9IG5ldyBjYy5Ob2RlKCdCYXJCZycpO1xuICAgICAgICBoZWFsdGhCYXJOb2RlLmFkZENoaWxkKGJhckJnTm9kZSk7XG4gICAgICAgIGxldCBiYXJCZ1Nwcml0ZSA9IGJhckJnTm9kZS5hZGRDb21wb25lbnQoY2MuU3ByaXRlKTtcbiAgICAgICAgYmFyQmdTcHJpdGUuY29sb3IgPSBjYy5Db2xvci5SRUQ7XG4gICAgICAgIFxuICAgICAgICAvLyDliJvlu7rooYDph4/mnaFcbiAgICAgICAgbGV0IGJhck5vZGUgPSBuZXcgY2MuTm9kZSgnQmFyJyk7XG4gICAgICAgIGhlYWx0aEJhck5vZGUuYWRkQ2hpbGQoYmFyTm9kZSk7XG4gICAgICAgIGxldCBiYXJTcHJpdGUgPSBiYXJOb2RlLmFkZENvbXBvbmVudChjYy5TcHJpdGUpO1xuICAgICAgICBiYXJTcHJpdGUuY29sb3IgPSBjYy5Db2xvci5HUkVFTjtcbiAgICAgICAgXG4gICAgICAgIC8vIOiuvue9ruihgOadoeWwuuWvuOWSjOS9jee9rlxuICAgICAgICBoZWFsdGhCYXJOb2RlLndpZHRoID0gMTAwO1xuICAgICAgICBoZWFsdGhCYXJOb2RlLmhlaWdodCA9IDEwO1xuICAgICAgICBiYXJCZ05vZGUud2lkdGggPSAxMDA7XG4gICAgICAgIGJhckJnTm9kZS5oZWlnaHQgPSAxMDtcbiAgICAgICAgYmFyTm9kZS53aWR0aCA9IDEwMDtcbiAgICAgICAgYmFyTm9kZS5oZWlnaHQgPSAxMDtcbiAgICAgICAgXG4gICAgICAgIC8vIOWwhuihgOadoeaUvuWcqOaAqueJqeS4iuaWuVxuICAgICAgICBoZWFsdGhCYXJOb2RlLnNldFBvc2l0aW9uKDAsIHRoaXMubm9kZS5oZWlnaHQgLyAyICsgMTApO1xuICAgICAgICBcbiAgICAgICAgLy8g5L+d5a2Y5byV55SoXG4gICAgICAgIHRoaXMuaGVhbHRoQmFyID0gaGVhbHRoQmFyTm9kZTtcbiAgICAgICAgdGhpcy5oZWFsdGhCYXJCZyA9IGJhckJnTm9kZTtcbiAgICB9LFxuIFxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUhlYWx0aEJhcigpO1xuICAgIH0sXG4gXG4gICAgdGFrZURhbWFnZShkYW1hZ2UpIHtcbiAgICAgICAgLy8g5aaC5p6c5bey57uP5Zyo5q275Lqh6L+H56iL5Lit77yM5LiN5YaN5aSE55CG5Lyk5a6zXG4gICAgICAgIGlmICh0aGlzLmlzRHlpbmcpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIGlmICh0eXBlb2YgZGFtYWdlICE9PSAnbnVtYmVyJyB8fCBkYW1hZ2UgPD0gMCkgcmV0dXJuO1xuICAgICAgICBcbiAgICAgICAgLy8g5L2/55SoIHBsYXlFZmZlY3Qg5pKt5pS+6Z+z5pWIXG4gICAgICAgIGlmICh0aGlzLmhpdEF1ZGlvKSB7XG4gICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KHRoaXMuaGl0QXVkaW8sIGZhbHNlLCAwLjMpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDlh4/lsJHnlJ/lkb3lgLxcbiAgICAgICAgdGhpcy5jdXJyZW50SGVhbHRoID0gTWF0aC5tYXgoMCwgdGhpcy5jdXJyZW50SGVhbHRoIC0gZGFtYWdlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIOabtOaWsOihgOadoeaYvuekulxuICAgICAgICBpZiAodGhpcy5iYXJOb2RlICYmIHRoaXMub3JpZ2luYWxCYXJXaWR0aCkge1xuICAgICAgICAgICAgbGV0IGhlYWx0aFBlcmNlbnRhZ2UgPSB0aGlzLmN1cnJlbnRIZWFsdGggLyB0aGlzLm1heEhlYWx0aDtcbiAgICAgICAgICAgIHRoaXMuYmFyTm9kZS53aWR0aCA9IHRoaXMub3JpZ2luYWxCYXJXaWR0aCAqIGhlYWx0aFBlcmNlbnRhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNjLmxvZygn5oCq54mp5Y+X5Yiw5Lyk5a6zOicsIGRhbWFnZSwgJ+W9k+WJjeeUn+WRveWAvDonLCB0aGlzLmN1cnJlbnRIZWFsdGgpO1xuICAgICAgICBcbiAgICAgICAgLy8g5qOA5p+l5piv5ZCm5q275LqhXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRIZWFsdGggPD0gMCAmJiAhdGhpcy5pc0R5aW5nKSB7XG4gICAgICAgICAgICB0aGlzLmRpZSgpO1xuICAgICAgICB9XG4gICAgfSxcbiBcbiAgICB1cGRhdGVIZWFsdGhCYXIoKSB7XG4gICAgICAgIGlmICh0aGlzLmhlYWx0aEJhcikge1xuICAgICAgICAgICAgbGV0IGhlYWx0aFBlcmNlbnRhZ2UgPSB0aGlzLmN1cnJlbnRIZWFsdGggLyB0aGlzLm1heEhlYWx0aDtcbiAgICAgICAgICAgIHRoaXMuaGVhbHRoQmFyLndpZHRoID0gMTAwICogaGVhbHRoUGVyY2VudGFnZTtcbiAgICAgICAgfVxuICAgIH0sXG4gXG4gICAgZGllKCkge1xuICAgICAgICAvLyDorr7nva7mrbvkuqHmoIforrBcbiAgICAgICAgaWYgKHRoaXMuaXNEeWluZykgcmV0dXJuO1xuICAgICAgICB0aGlzLmlzRHlpbmcgPSB0cnVlO1xuICAgICAgICBcbiAgICAgICAgLy8g5L2/55SoIHBsYXlFZmZlY3Qg5pKt5pS+6Z+z5pWIXG4gICAgICAgIGlmICh0aGlzLmRlYXRoQXVkaW8pIHtcbiAgICAgICAgICAgIGxldCBhdWRpb0lkID0gY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh0aGlzLmRlYXRoQXVkaW8sIGZhbHNlLCAwLjMpO1xuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc2V0RmluaXNoQ2FsbGJhY2soYXVkaW9JZCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHlpbmcpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIC8vIOiOt+WPlueOqeWutuiKgueCuVxuICAgICAgICBsZXQgcGxheWVyID0gY2MuZmluZCgnQ2FudmFzL2dhbWUvcGxheWVyJyk7XG4gICAgICAgIGlmICghcGxheWVyKSB7XG4gICAgICAgICAgICBjYy53YXJuKCfmib7kuI3liLDnjqnlrrboioLngrnvvIHor7fnoa7kv53lnLrmma/kuK3njqnlrrboioLngrnnmoTot6/lvoTmmK8gQ2FudmFzL2dhbWUvcGxheWVyJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIOiOt+WPluS4lueVjOWdkOagh+S4i+eahOS9jee9rlxuICAgICAgICBsZXQgbW9uc3RlclBvcyA9IHRoaXMubm9kZS5wYXJlbnQuY29udmVydFRvV29ybGRTcGFjZUFSKHRoaXMubm9kZS5wb3NpdGlvbik7XG4gICAgICAgIGxldCBwbGF5ZXJQb3MgPSBwbGF5ZXIucGFyZW50LmNvbnZlcnRUb1dvcmxkU3BhY2VBUihwbGF5ZXIucG9zaXRpb24pO1xuICAgICAgICBcbiAgICAgICAgLy8g6K6h566X5LiO546p5a6255qE6Led56a7XG4gICAgICAgIGxldCBkaXN0YW5jZSA9IGNjLlZlYzIuZGlzdGFuY2UoXG4gICAgICAgICAgICBjYy52Mihtb25zdGVyUG9zLngsIG1vbnN0ZXJQb3MueSksXG4gICAgICAgICAgICBjYy52MihwbGF5ZXJQb3MueCwgcGxheWVyUG9zLnkpXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICAvLyDmt7vliqDosIPor5Xml6Xlv5dcbiAgICAgICAgY2MubG9nKCfmgKrniankvY3nva46JywgbW9uc3RlclBvcywgJ+eOqeWutuS9jee9rjonLCBwbGF5ZXJQb3MsICfot53nprs6JywgZGlzdGFuY2UsICfmo4DmtYvojIPlm7Q6JywgdGhpcy5kZXRlY3Rpb25SYWRpdXMpO1xuICAgICAgICBcbiAgICAgICAgLy8g5Zyo5qOA5rWL6IyD5Zu05YaFXG4gICAgICAgIGlmIChkaXN0YW5jZSA8IHRoaXMuZGV0ZWN0aW9uUmFkaXVzKSB7XG4gICAgICAgICAgICAvLyDov73ouKrnjqnlrrZcbiAgICAgICAgICAgIGxldCBkaXJlY3Rpb24gPSBjYy52MihcbiAgICAgICAgICAgICAgICBwbGF5ZXJQb3MueCAtIG1vbnN0ZXJQb3MueCxcbiAgICAgICAgICAgICAgICBwbGF5ZXJQb3MueSAtIG1vbnN0ZXJQb3MueVxuICAgICAgICAgICAgKS5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHZlbG9jaXR5ID0gdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpLmxpbmVhclZlbG9jaXR5O1xuICAgICAgICAgICAgdmVsb2NpdHkueCA9IGRpcmVjdGlvbi54ICogdGhpcy5tb3ZlU3BlZWQ7XG4gICAgICAgICAgICB2ZWxvY2l0eS55ID0gZGlyZWN0aW9uLnkgKiB0aGlzLm1vdmVTcGVlZDtcbiAgICAgICAgICAgIHRoaXMubm9kZS5nZXRDb21wb25lbnQoY2MuUmlnaWRCb2R5KS5saW5lYXJWZWxvY2l0eSA9IHZlbG9jaXR5O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjYy5sb2coJ+aAqueJqeato+WcqOenu+WKqO+8jOmAn+W6pjonLCB2ZWxvY2l0eSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIOWPkeWwhOeCuOW8uVxuICAgICAgICAgICAgdGhpcy5zaG9vdEJvbWIocGxheWVyLnBvc2l0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIOWBnOatouenu+WKqFxuICAgICAgICAgICAgbGV0IHZlbG9jaXR5ID0gdGhpcy5ub2RlLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpLmxpbmVhclZlbG9jaXR5O1xuICAgICAgICAgICAgdmVsb2NpdHkueCA9IDA7XG4gICAgICAgICAgICB2ZWxvY2l0eS55ID0gMDtcbiAgICAgICAgICAgIHRoaXMubm9kZS5nZXRDb21wb25lbnQoY2MuUmlnaWRCb2R5KS5saW5lYXJWZWxvY2l0eSA9IHZlbG9jaXR5O1xuICAgICAgICAgICAgY2MubG9nKCfmgKrnianlgZzmraLnp7vliqjvvIzotoXlh7rmo4DmtYvojIPlm7QnKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgc2hvb3RCb21iKHRhcmdldFBvcykge1xuICAgICAgICBjb25zdCBjdXJyZW50VGltZSA9IGNjLmRpcmVjdG9yLmdldFRvdGFsVGltZSgpIC8gMTAwMDtcbiAgICAgICAgXG4gICAgICAgIGNjLmxvZygn5bCd6K+V5Y+R5bCE54K45by5IC0g5b2T5YmN5pe26Ze0OicsIGN1cnJlbnRUaW1lLCBcbiAgICAgICAgICAgICAgICfkuIrmrKHlj5HlsITml7bpl7Q6JywgdGhpcy5sYXN0U2hvb3RUaW1lLCBcbiAgICAgICAgICAgICAgICflj5HlsITpl7TpmpQ6JywgdGhpcy5zaG9vdEludGVydmFsLFxuICAgICAgICAgICAgICAgJ+aYr+WQpuWPr+S7peWPkeWwhDonLCAoY3VycmVudFRpbWUgLSB0aGlzLmxhc3RTaG9vdFRpbWUgPj0gdGhpcy5zaG9vdEludGVydmFsKSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY3VycmVudFRpbWUgLSB0aGlzLmxhc3RTaG9vdFRpbWUgPCB0aGlzLnNob290SW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKCF0aGlzLmJvbWJQcmVmYWIpIHtcbiAgICAgICAgICAgIGNjLmVycm9yKCfngrjlvLnpooTliLbkvZPmnKrorr7nva7vvIHor7flnKjnvJbovpHlmajkuK3orr7nva4gTW9uc3RlciDnu4Tku7bnmoQgQm9tYiBQcmVmYWIg5bGe5oCnJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMubGFzdFNob290VGltZSA9IGN1cnJlbnRUaW1lO1xuICAgICAgICBcbiAgICAgICAgLy8g5Yib5bu654K45by5XG4gICAgICAgIGxldCBib21iID0gY2MuaW5zdGFudGlhdGUodGhpcy5ib21iUHJlZmFiKTtcbiAgICAgICAgaWYgKCFib21iKSB7XG4gICAgICAgICAgICBjYy5lcnJvcign54K45by56aKE5Yi25L2T5a6e5L6L5YyW5aSx6LSl77yBJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIOiuvue9rueCuOW8ueS9jee9ruS4uuaAqueJqeW9k+WJjeS9jee9rlxuICAgICAgICBib21iLnNldFBvc2l0aW9uKHRoaXMubm9kZS5wb3NpdGlvbik7XG4gICAgICAgIHRoaXMubm9kZS5wYXJlbnQuYWRkQ2hpbGQoYm9tYik7XG4gICAgICAgIFxuICAgICAgICAvLyDorqHnrpfmlrnlkJHvvIjkvb/nlKjmnKzlnLDlnZDmoIfvvIlcbiAgICAgICAgbGV0IGRpcmVjdGlvbiA9IHRhcmdldFBvcy5zdWIodGhpcy5ub2RlLnBvc2l0aW9uKTtcbiAgICAgICAgXG4gICAgICAgIC8vIOiuvue9rueCuOW8ueWxnuaAp1xuICAgICAgICBsZXQgYm9tYkNvbXAgPSBib21iLmdldENvbXBvbmVudCgnQm9tYicpO1xuICAgICAgICBpZiAoYm9tYkNvbXApIHtcbiAgICAgICAgICAgIGJvbWJDb21wLnNldERpcmVjdGlvbihkaXJlY3Rpb24pO1xuICAgICAgICAgICAgYm9tYkNvbXAuc2V0U3BlZWQoMzAwKTsgLy8g5aKe5Yqg6YCf5bqm5L2/54K45by556e75Yqo5pu05piO5pi+XG4gICAgICAgICAgICBib21iQ29tcC5zZXREYW1hZ2UoMjApO1xuICAgICAgICAgICAgY2MubG9nKCfngrjlvLnlt7Llj5HlsITvvIHmlrnlkJE6JywgZGlyZWN0aW9uLCAn55uu5qCH5L2N572uOicsIHRhcmdldFBvcywgJ+W9k+WJjeS9jee9rjonLCB0aGlzLm5vZGUucG9zaXRpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MuZXJyb3IoJ+eCuOW8ueayoeaciUJvbWLnu4Tku7bvvIHor7fnoa7kv53ngrjlvLnpooTliLbkvZPlt7Lmt7vliqAgQm9tYiDnu4Tku7YnKTtcbiAgICAgICAgICAgIGJvbWIuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgfVxufSk7IFxuIl19