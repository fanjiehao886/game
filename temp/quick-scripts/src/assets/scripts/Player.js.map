{"version":3,"sources":["assets/scripts/Player.js"],"names":["cc","Class","Component","properties","moveDir","v2","displayName","tooltip","_speedType","JoystickEnum","SpeedType","STOP","type","_moveSpeed","stopSpeed","Integer","normalSpeed","fastSpeed","audio_collide","AudioClip","audio_bg","bulletPre","Prefab","shootInterval","Float","lastFiretime","onLoad","JoystickEvent","getInstance","on","JoystickEventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","start","audioEngine","playMusic","shoot","monster","currentTime","director","getTotalTime","bullet","instantiate","setPosition","node","position","parent","addChild","monsterPos","dir","sub","normalize","bulletComp","getComponent","setDirection","setSpeed","setDamage","onEndContact","contact","selfCollider","otherCollider","currentAudio","playEffect","event","data","speedType","moveDistance","onTouchEnemy","dt","move","lv","RigidBody","linearVelocity","x","y","detectEnemy","enemy","getChildByName","playerPos","distance","mag","console","log","update","NORMAL","FAST"],"mappings":"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","sourceRoot":"/","sourcesContent":["import JoystickEnum from \"JoystickEnum\";\nimport JoystickEvent from \"JoystickEvent\";\n\ncc.Class({\n    extends: cc.Component,\n    properties: {\n\n        // from joystick\n        moveDir: {\n            default: cc.v2(0, 1),\n            displayName: 'Move Dir',\n            tooltip: '移动方向',\n        },\n        _speedType: {\n            default: JoystickEnum.SpeedType.STOP,\n            displayName: 'Speed Type',\n            type: JoystickEnum.SpeedType,\n            tooltip: '速度级别'\n        },\n\n        // from self\n        _moveSpeed: {\n            default: 0,\n            displayName: 'Move Speed',\n            tooltip: '移动速度'\n        },\n\n        stopSpeed: {\n            default: 0,\n            type: cc.Integer,\n            tooltip: '停止时速度'\n        },\n        normalSpeed: {\n            default: 100,\n            type: cc.Integer,\n            tooltip: '正常速度'\n        },\n        fastSpeed: {\n            default: 200,\n            type: cc.Integer,\n            tooltip: '最快速度'\n        },\n        audio_collide: {\n            default: null,\n            type: cc.AudioClip,\n            tooltip: '碰撞音效'\n        },\n        audio_bg: {\n            default: null,\n            type: cc.AudioClip,\n            tooltip: '背景音乐'\n        },\n        bulletPre: {\n            default: null,\n            type: cc.Prefab,\n        },\n        shootInterval: {\n            default: 0.05,\n            type: cc.Float,\n        },\n        lastFiretime: {\n            default: 0,\n            type: cc.Float,\n        },\n\n    },\n\n    onLoad() {\n        JoystickEvent.getInstance().on(JoystickEnum.JoystickEventType.TOUCH_START, this.onTouchStart, this);\n        JoystickEvent.getInstance().on(JoystickEnum.JoystickEventType.TOUCH_MOVE, this.onTouchMove, this);\n        JoystickEvent.getInstance().on(JoystickEnum.JoystickEventType.TOUCH_END, this.onTouchEnd, this);\n    },\n\n    start() {\n        cc.audioEngine.playMusic(this.audio_bg, true);\n    },\n\n    shoot(monster) {\n        const currentTime = cc.director.getTotalTime() / 1000;\n        if (currentTime - this.lastFiretime > this.shootInterval) {\n            this.lastFiretime = currentTime;\n            let bullet = cc.instantiate(this.bulletPre);\n            bullet.setPosition(this.node.position);\n            this.node.parent.addChild(bullet);\n\n            let monsterPos = monster.position;\n            let dir = monsterPos.sub(bullet.position).normalize();\n            \n            let bulletComp = bullet.getComponent('bullets');\n            bulletComp.setDirection(dir);\n            bulletComp.setSpeed(200);\n            bulletComp.setDamage(10);\n        }\n    },\n\n    onEndContact: function (contact, selfCollider, otherCollider) {\n        //play sound effect\n        this.currentAudio = cc.audioEngine.playEffect(this.audio_collide, false);\n    },\n\n    onTouchStart() {\n\n    },\n\n    onTouchMove(event, data) {\n        this._speedType = data.speedType;\n        this.moveDir = data.moveDistance;\n    },\n\n    onTouchEnd(event, data) {\n        this._speedType = data.speedType;\n    },\n    onTouchEnemy(monster, dt) {\n        this.shoot(monster);\n    },\n\n    // methods\n    move() {\n        // this.node.angle = cc.misc.radiansToDegrees(\n        //     Math.atan2(this.moveDir.y, this.moveDir.x)\n        // ) - 90;\n        //let newPos = this.node.position.add(this.moveDir.mul(this._moveSpeed / 120));\n        //this.node.setPosition(newPos);\n        let lv = this.node.getComponent(cc.RigidBody).linearVelocity;\n        //console.log(this._moveSpeed);\n        lv.x  = this.moveDir.x * this._moveSpeed / 2;\n        lv.y  = this.moveDir.y * this._moveSpeed / 2;\n        this.node.getComponent(cc.RigidBody).linearVelocity = lv;\n    },\n    detectEnemy(dt) {\n        let enemy = this.node.parent.getChildByName('enemy');\n        let monster = enemy.getChildByName('monster');\n        if (monster) {\n            let monsterPos = monster.position;\n            let playerPos = this.node.position;\n            let distance = monsterPos.sub(playerPos).mag();\n            if (distance < 200) {\n                console.log(\"touch monster\");\n                this.onTouchEnemy(monster, dt);\n            }\n        }\n        else {\n            console.log(\"no monster\");\n        }\n    },\n\n    update(dt) {\n        switch (this._speedType) {\n            case JoystickEnum.SpeedType.STOP:\n                this._moveSpeed = this.stopSpeed;\n                break;\n            case JoystickEnum.SpeedType.NORMAL:\n                this._moveSpeed = this.normalSpeed;\n                break;\n            case JoystickEnum.SpeedType.FAST:\n                this._moveSpeed = this.fastSpeed;\n                break;\n            default:\n                break;\n        }\n        this.move();\n        this.detectEnemy(dt);\n    },\n});\n"]}