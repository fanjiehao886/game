{"version":3,"sources":["assets/scripts/game.js"],"names":["cc","Class","Component","properties","tiledMap","TiledMap","goldLabel","type","Label","tooltip","statics","instance","addGold","amount","_goldCount","string","onLoad","constructor","p","director","getPhysicsManager","enabled","debugDrawFlags","gravity","v2","document","addEventListener","resources","load","AudioClip","err","audioClip","audioSource","addComponent","AudioSource","clip","play","start","tiledSize","getTileSize","layer","getLayer","layerSize","getLayerSize","i","width","j","height","tiled","getTiledTileAt","gid","node","group","body","RigidBody","RigidBodyType","Static","collider","PhysicsBoxCollider","offset","size","apply"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tiledMap: cc.TiledMap,\n        goldLabel: {\n            default: null,\n            type: cc.Label,\n            tooltip: '金币数量显示文本'\n        }\n    },\n\n    statics: {\n        instance: null,\n        addGold(amount) {\n            this._goldCount += amount;\n            if(this.instance && this.instance.goldLabel) {\n                this.instance.goldLabel.string = this._goldCount;\n            }\n        }\n    },\n\n    _goldCount: 0,\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        // 初始化静态实例\n        this.constructor.instance = this;\n        \n        let p = cc.director.getPhysicsManager();\n        p.enabled = true;\n        p.debugDrawFlags = false;\n        p.gravity = cc.v2(0,0);\n        \n        // 初始化金币显示\n        this.goldLabel.string = this._goldCount;\n\n        document.addEventListener('WeixinJSBridgeReady', function () {\n            cc.resources.load('audios/rock', cc.AudioClip, (err, audioClip) => {\n                var audioSource = this.addComponent(cc.AudioSource);\n                audioSource.clip = audioClip;\n                audioSource.play();\n            });\n        });\n    },\n\n    start () {\n        let tiledSize = this.tiledMap.getTileSize();\n        let layer = this.tiledMap.getLayer('fences');\n        let layerSize = layer.getLayerSize();\n\n        for (let i = 0; i < layerSize.width; i++) {\n            for(let j=0; j<layerSize.height; j++){\n                let tiled = layer.getTiledTileAt(i, j, true);\n                if(tiled.gid != 0){\n                    tiled.node.group = 'wall';\n                    let body = tiled.node.addComponent(cc.RigidBody);\n                    body.type = cc.RigidBodyType.Static;\n                    let collider = tiled.node.addComponent(cc.PhysicsBoxCollider);\n                    collider.offset = cc.v2(tiledSize.width/2, tiledSize.height/2);\n                    collider.size = tiledSize;\n                    collider.apply();\n                }\n            }\n        }\n\n    },\n\n    // update (dt) {},\n});\n"]}